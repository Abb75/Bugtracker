{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Alexandre Brosseau/Desktop/bug_tracker/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Alexandre Brosseau/Desktop/bug_tracker/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";var baseUrl='http://127.0.0.1:8000/api/';export function isTokenExpired(token){if(!token){console.log('RRRRRR');// Supprimer les tokens du local storage\nlocalStorage.removeItem('access_token');localStorage.removeItem('refresh_token');return true;// Si le token n'est pas présent, il est considéré comme expiré\n}var tokenParts=token.split('.');if(tokenParts.length!==3){return true;// Structure du token invalide\n}var tokenPayload=JSON.parse(atob(tokenParts[1]));var expirationTimestamp=tokenPayload.exp;var currentTimestamp=Math.ceil(Date.now()/1000);return expirationTimestamp<currentTimestamp;// Vérifie si le token est expiré\n}var axiosInstance=axios.create({baseUrl:baseUrl,//timeout: 15000,\nheaders:{Authorization:localStorage.getItem('access_token')?'JWT'+localStorage.getItem('access_token'):null,'Content-Type':'application/json',accept:'application/json'}});axiosInstance.interceptors.response.use(function(response){return response;},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(error){var originalRequest,refreshToken,tokenParts,now;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:originalRequest=error.config;if(!(typeof error.response==='undefined')){_context.next=4;break;}alert('Server Off');return _context.abrupt(\"return\",Promise.reject(error));case 4:if(!(error.response.status===401&&originalRequest.url===baseUrl+'token/refresh/')){_context.next=7;break;}window.location.href='/login/';return _context.abrupt(\"return\",Promise.reject(error));case 7:if(!(error.response.data.code==='token_not_valid'&&error.response.status===401&&error.response.statusText==='Unauthorized')){_context.next=26;break;}refreshToken=localStorage.getItem('refresh_token');if(!refreshToken){_context.next=24;break;}tokenParts=JSON.parse(atob(refreshToken.split('.')[1]));now=Math.ceil(Date.now()/1000);console.log(tokenParts.exp);if(!(tokenParts.exp>now)){_context.next=17;break;}return _context.abrupt(\"return\",axiosInstance.post('http://127.0.0.1:8000/api/token/refresh/',{refresh:refreshToken}).then(function(response){localStorage.setItem('access_token',response.data.access);localStorage.setItem('refresh_token',response.data.refresh);axiosInstance.defaults.headers['Authorization']='JWT '+response.data.access;originalRequest.headers['Authorization']='JWT '+response.data.access;return axiosInstance(originalRequest);}).catch(function(err){console.log(err);}));case 17:console.log('refresh token is expired',tokenParts.exp,now);console.log('EEEEEE');localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');window.location.href='/login/';case 22:_context.next=26;break;case 24:console.log('Refresk token not available');window.location.href='/login/';case 26:return _context.abrupt(\"return\",Promise.reject(error));case 27:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());export default axiosInstance;","map":{"version":3,"names":["axios","baseUrl","isTokenExpired","token","console","log","localStorage","removeItem","tokenParts","split","length","tokenPayload","JSON","parse","atob","expirationTimestamp","exp","currentTimestamp","Math","ceil","Date","now","axiosInstance","create","headers","Authorization","getItem","accept","interceptors","response","use","error","originalRequest","config","alert","Promise","reject","status","url","window","location","href","data","code","statusText","refreshToken","post","refresh","then","setItem","access","defaults","catch","err"],"sources":["C:/Users/Alexandre Brosseau/Desktop/bug_tracker/frontend/src/axios.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst baseUrl = 'http://127.0.0.1:8000/api/';\r\n\r\nexport function isTokenExpired(token) {\r\n    if (!token) {\r\n        console.log('RRRRRR')\r\n        // Supprimer les tokens du local storage\r\n        localStorage.removeItem('access_token');\r\n        localStorage.removeItem('refresh_token');\r\n\r\n       \r\n    \r\n        return true; // Si le token n'est pas présent, il est considéré comme expiré\r\n    }\r\n\r\n    const tokenParts = token.split('.');\r\n    if (tokenParts.length !== 3) {\r\n        return true; // Structure du token invalide\r\n    }\r\n\r\n    const tokenPayload = JSON.parse(atob(tokenParts[1]));\r\n    const expirationTimestamp = tokenPayload.exp;\r\n    const currentTimestamp = Math.ceil(Date.now() / 1000);\r\n\r\n    return expirationTimestamp < currentTimestamp; // Vérifie si le token est expiré\r\n}\r\n\r\n\r\nconst axiosInstance = axios.create({\r\n    baseUrl: baseUrl,\r\n    //timeout: 15000,\r\n    headers: {\r\n        Authorization: localStorage.getItem('access_token')\r\n        ? 'JWT' + localStorage.getItem('access_token')\r\n        : null,\r\n        'Content-Type': 'application/json',\r\n        accept: 'application/json',\r\n    },\r\n});\r\n\r\n\r\naxiosInstance.interceptors.response.use(\r\n    (response) => {\r\n        return response;\r\n\r\n\r\n    },\r\n    async function (error) {\r\n        const originalRequest = error.config;\r\n        if (typeof error.response === 'undefined') {\r\n            alert('Server Off');\r\n        return Promise.reject(error)\r\n        }\r\n\r\n        if ( error.response.status === 401 &&\r\n            originalRequest.url === baseUrl + 'token/refresh/')\r\n    {\r\n        window.location.href = '/login/';\r\n        return Promise.reject(error);\r\n    }\r\n\r\n    if (\r\n        error.response.data.code === 'token_not_valid' &&\r\n        error.response.status === 401 && \r\n        error.response.statusText === 'Unauthorized'\r\n    ) {\r\n        const refreshToken = localStorage.getItem('refresh_token');\r\n    \r\n    \r\n\r\n    if (refreshToken) {\r\n        const tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\r\n        const now = Math.ceil(Date.now()/1000);\r\n        console.log(tokenParts.exp)\r\n\r\n        if (tokenParts.exp > now) {\r\n            return axiosInstance\r\n            .post('http://127.0.0.1:8000/api/token/refresh/', { refresh: refreshToken})\r\n            .then((response) => {\r\n                localStorage.setItem('access_token', response.data.access);\r\n                localStorage.setItem('refresh_token', response.data.refresh);\r\n\r\n                axiosInstance.defaults.headers['Authorization'] = \r\n                'JWT ' + response.data.access;\r\n\r\n                originalRequest.headers['Authorization'] = \r\n                'JWT ' + response.data.access;\r\n\r\n                return axiosInstance(originalRequest)\r\n            })\r\n\r\n            .catch((err) => {\r\n                console.log(err)\r\n            });\r\n        } else {\r\n            console.log('refresh token is expired' , tokenParts.exp, now);\r\n            console.log('EEEEEE')\r\n            localStorage.removeItem('access_token');\r\n            localStorage.removeItem('refresh_token');\r\n            window.location.href = '/login/';\r\n        }\r\n\r\n    }else {\r\n        console.log('Refresk token not available');\r\n        window.location.href = '/login/';\r\n        }\r\n\r\n    }\r\n\r\n     return Promise.reject(error);\r\n\r\n    }\r\n);\r\n\r\nexport default axiosInstance;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}